/**
 * freq_table.h - Combined frequency lookup table
 * 
 * Maps ADC values (0-255) to frequency settings for the PIC16F18344.
 * Smooth logarithmic sweep from 1 Hz to 1 MHz - no jumps at mode transitions.
 * 
 * Two modes (transparent to user):
 *   - Software mode (1-11 Hz): Delay loops, table contains half-period cycles
 *   - NCO mode (12+ Hz): Hardware NCO, table contains NCO increment
 * 
 * Bit 31 indicates mode:
 *   - Bit 31 = 0: NCO mode, lower 20 bits = NCO increment value
 *   - Bit 31 = 1: Software mode, lower 24 bits = half-period in cycles
 * 
 * Frequency formula: freq[i] = exp(i * ln(1000000) / 255)
 * Step ratio: 5.57% per index (smooth logarithmic progression)
 * 
 * NCO FDC mode: Output toggles on each accumulator overflow, so:
 *   F_out = (24 MHz x NCO_INC) / 2^21
 * Software: F_out = 24 MHz / (2 x half_period_cycles)
 */

#ifndef FREQ_TABLE_H
#define FREQ_TABLE_H

#include <stdint.h>

#define FREQ_MODE_SOFTWARE  0x80000000UL
#define FREQ_MODE_MASK      0x80000000UL
#define FREQ_VALUE_MASK     0x00FFFFFFUL

#define IS_SOFTWARE_MODE(x) ((x) & FREQ_MODE_MASK)
#define GET_FREQ_VALUE(x)   ((x) & FREQ_VALUE_MASK)

/**
 * Frequency table: 256 entries, logarithmic 1 Hz to 1 MHz
 * 
 * freq[i] = exp(i * ln(1000000) / 255) Hz
 * 
 * Software mode (i=0-44): half_period = 12000000 / freq  (cycles @ 24 MHz)
 * NCO mode (i=45-255): nco_inc = freq * 2097152 / 24000000
 * 
 * Crossover at index 45: ~11.4 Hz (NCO minimum with increment=1 = 11.44 Hz)
 */
static const uint32_t freq_table[256] = {
    // Index 0-44: Software mode (1 Hz to 11 Hz)
    // Value = 0x80000000 | half_period_cycles
    0x80B71B00,  //   0:    1.00 Hz
    0x80AD72F4,  //   1:    1.06 Hz
    0x80A44D47,  //   2:    1.11 Hz
    0x809BA318,  //   3:    1.18 Hz
    0x80936DE4,  //   4:    1.24 Hz
    0x808BA77F,  //   5:    1.31 Hz
    0x80844A12,  //   6:    1.38 Hz
    0x807D5014,  //   7:    1.46 Hz
    0x8076B445,  //   8:    1.54 Hz
    0x807071AF,  //   9:    1.63 Hz
    0x806A839E,  //  10:    1.72 Hz
    0x8064E59B,  //  11:    1.81 Hz
    0x805F936E,  //  12:    1.92 Hz
    0x805A8917,  //  13:    2.02 Hz
    0x8055C2CD,  //  14:    2.14 Hz
    0x80513CF9,  //  15:    2.25 Hz
    0x804CF434,  //  16:    2.38 Hz
    0x8048E546,  //  17:    2.51 Hz
    0x80450D22,  //  18:    2.65 Hz
    0x804168E5,  //  19:    2.80 Hz
    0x803DF5D2,  //  20:    2.96 Hz
    0x803AB151,  //  21:    3.12 Hz
    0x803798ED,  //  22:    3.29 Hz
    0x8034AA53,  //  23:    3.48 Hz
    0x8031E34F,  //  24:    3.67 Hz
    0x802F41CA,  //  25:    3.87 Hz
    0x802CC3CA,  //  26:    4.09 Hz
    0x802A676F,  //  27:    4.32 Hz
    0x80282AF3,  //  28:    4.56 Hz
    0x80260CA9,  //  29:    4.81 Hz
    0x80240AF7,  //  30:    5.08 Hz
    0x8022245D,  //  31:    5.36 Hz
    0x8020576C,  //  32:    5.66 Hz
    0x801EA2CB,  //  33:    5.98 Hz
    0x801D0530,  //  34:    6.31 Hz
    0x801B7D65,  //  35:    6.66 Hz
    0x801A0A43,  //  36:    7.03 Hz
    0x8018AAB4,  //  37:    7.42 Hz
    0x80175DB0,  //  38:    7.84 Hz
    0x8016223B,  //  39:    8.27 Hz
    0x8014F769,  //  40:    8.73 Hz
    0x8013DC59,  //  41:    9.22 Hz
    0x8012D037,  //  42:    9.73 Hz
    0x8011D239,  //  43:   10.27 Hz
    0x8010E1A0,  //  44:   10.85 Hz
    
    // Index 45-255: NCO mode (11 Hz to 1 MHz)
    // Value = NCO increment (20-bit)
             1,  //  45:      11 Hz
             1,  //  46:      12 Hz
             1,  //  47:      13 Hz
             1,  //  48:      13 Hz
             1,  //  49:      14 Hz
             1,  //  50:      15 Hz
             1,  //  51:      16 Hz
             1,  //  52:      17 Hz
             2,  //  53:      18 Hz
             2,  //  54:      19 Hz
             2,  //  55:      20 Hz
             2,  //  56:      21 Hz
             2,  //  57:      22 Hz
             2,  //  58:      23 Hz
             2,  //  59:      24 Hz
             2,  //  60:      26 Hz
             2,  //  61:      27 Hz
             3,  //  62:      29 Hz
             3,  //  63:      30 Hz
             3,  //  64:      32 Hz
             3,  //  65:      34 Hz
             3,  //  66:      36 Hz
             3,  //  67:      38 Hz
             3,  //  68:      40 Hz
             4,  //  69:      42 Hz
             4,  //  70:      44 Hz
             4,  //  71:      47 Hz
             4,  //  72:      49 Hz
             5,  //  73:      52 Hz
             5,  //  74:      55 Hz
             5,  //  75:      58 Hz
             5,  //  76:      61 Hz
             6,  //  77:      65 Hz
             6,  //  78:      68 Hz
             6,  //  79:      72 Hz
             7,  //  80:      76 Hz
             7,  //  81:      81 Hz
             7,  //  82:      85 Hz
             8,  //  83:      90 Hz
             8,  //  84:      95 Hz
             9,  //  85:     100 Hz
             9,  //  86:     106 Hz
            10,  //  87:     111 Hz
            10,  //  88:     118 Hz
            11,  //  89:     124 Hz
            11,  //  90:     131 Hz
            12,  //  91:     138 Hz
            13,  //  92:     146 Hz
            13,  //  93:     154 Hz
            14,  //  94:     163 Hz
            15,  //  95:     172 Hz
            16,  //  96:     181 Hz
            17,  //  97:     192 Hz
            18,  //  98:     202 Hz
            19,  //  99:     214 Hz
            20,  // 100:     225 Hz
            21,  // 101:     238 Hz
            22,  // 102:     251 Hz
            23,  // 103:     265 Hz
            24,  // 104:     280 Hz
            26,  // 105:     296 Hz
            27,  // 106:     312 Hz
            29,  // 107:     329 Hz
            30,  // 108:     348 Hz
            32,  // 109:     367 Hz
            34,  // 110:     387 Hz
            36,  // 111:     409 Hz
            38,  // 112:     432 Hz
            40,  // 113:     456 Hz
            42,  // 114:     481 Hz
            44,  // 115:     508 Hz
            47,  // 116:     536 Hz
            49,  // 117:     566 Hz
            52,  // 118:     598 Hz
            55,  // 119:     631 Hz
            58,  // 120:     666 Hz
            61,  // 121:     703 Hz
            65,  // 122:     742 Hz
            68,  // 123:     784 Hz
            72,  // 124:     827 Hz
            76,  // 125:     873 Hz
            81,  // 126:     922 Hz
            85,  // 127:     973 Hz
            90,  // 128:    1027 Hz
            95,  // 129:    1085 Hz
           100,  // 130:    1145 Hz
           106,  // 131:    1209 Hz
           112,  // 132:    1276 Hz
           118,  // 133:    1347 Hz
           124,  // 134:    1422 Hz
           131,  // 135:    1501 Hz
           138,  // 136:    1585 Hz
           146,  // 137:    1673 Hz
           154,  // 138:    1766 Hz
           163,  // 139:    1865 Hz
           172,  // 140:    1968 Hz
           182,  // 141:    2078 Hz
           192,  // 142:    2194 Hz
           202,  // 143:    2316 Hz
           214,  // 144:    2445 Hz
           226,  // 145:    2581 Hz
           238,  // 146:    2725 Hz
           251,  // 147:    2876 Hz
           265,  // 148:    3036 Hz
           280,  // 149:    3205 Hz
           296,  // 150:    3384 Hz
           312,  // 151:    3572 Hz
           330,  // 152:    3771 Hz
           348,  // 153:    3981 Hz
           367,  // 154:    4203 Hz
           388,  // 155:    4437 Hz
           409,  // 156:    4684 Hz
           432,  // 157:    4944 Hz
           456,  // 158:    5220 Hz
           481,  // 159:    5510 Hz
           508,  // 160:    5817 Hz
           537,  // 161:    6141 Hz
           566,  // 162:    6483 Hz
           598,  // 163:    6844 Hz
           631,  // 164:    7225 Hz
           666,  // 165:    7627 Hz
           704,  // 166:    8052 Hz
           743,  // 167:    8500 Hz
           784,  // 168:    8973 Hz
           828,  // 169:    9473 Hz
           874,  // 170:   10000 Hz
           922,  // 171:   10557 Hz
           974,  // 172:   11144 Hz
          1028,  // 173:   11765 Hz
          1085,  // 174:   12420 Hz
          1146,  // 175:   13111 Hz
          1209,  // 176:   13841 Hz
          1277,  // 177:   14612 Hz
          1348,  // 178:   15425 Hz
          1423,  // 179:   16284 Hz
          1502,  // 180:   17191 Hz
          1586,  // 181:   18148 Hz
          1674,  // 182:   19158 Hz
          1767,  // 183:   20225 Hz
          1866,  // 184:   21351 Hz
          1970,  // 185:   22539 Hz
          2079,  // 186:   23794 Hz
          2195,  // 187:   25119 Hz
          2317,  // 188:   26517 Hz
          2446,  // 189:   27994 Hz
          2582,  // 190:   29552 Hz
          2726,  // 191:   31197 Hz
          2878,  // 192:   32934 Hz
          3038,  // 193:   34768 Hz
          3207,  // 194:   36703 Hz
          3386,  // 195:   38747 Hz
          3574,  // 196:   40904 Hz
          3773,  // 197:   43181 Hz
          3983,  // 198:   45585 Hz
          4205,  // 199:   48123 Hz
          4439,  // 200:   50802 Hz
          4686,  // 201:   53630 Hz
          4947,  // 202:   56616 Hz
          5223,  // 203:   59768 Hz
          5513,  // 204:   63096 Hz
          5820,  // 205:   66608 Hz
          6144,  // 206:   70317 Hz
          6486,  // 207:   74231 Hz
          6848,  // 208:   78364 Hz
          7229,  // 209:   82727 Hz
          7631,  // 210:   87333 Hz
          8056,  // 211:   92195 Hz
          8505,  // 212:   97327 Hz
          8978,  // 213:  102746 Hz
          9478,  // 214:  108466 Hz
         10006,  // 215:  114505 Hz
         10563,  // 216:  120880 Hz
         11151,  // 217:  127609 Hz
         11771,  // 218:  134714 Hz
         12427,  // 219:  142214 Hz
         13119,  // 220:  150131 Hz
         13849,  // 221:  158489 Hz
         14620,  // 222:  167313 Hz
         15434,  // 223:  176628 Hz
         16293,  // 224:  186461 Hz
         17200,  // 225:  196842 Hz
         18158,  // 226:  207801 Hz
         19169,  // 227:  219370 Hz
         20236,  // 228:  231583 Hz
         21363,  // 229:  244475 Hz
         22552,  // 230:  258086 Hz
         23807,  // 231:  272455 Hz
         25133,  // 232:  287623 Hz
         26532,  // 233:  303636 Hz
         28009,  // 234:  320540 Hz
         29569,  // 235:  338386 Hz
         31215,  // 236:  357224 Hz
         32953,  // 237:  377112 Hz
         34787,  // 238:  398107 Hz
         36724,  // 239:  420271 Hz
         38768,  // 240:  443669 Hz
         40927,  // 241:  468369 Hz
         43205,  // 242:  494445 Hz
         45611,  // 243:  521972 Hz
         48150,  // 244:  551032 Hz
         50831,  // 245:  581709 Hz
         53660,  // 246:  614095 Hz
         56648,  // 247:  648283 Hz
         59802,  // 248:  684375 Hz
         63131,  // 249:  722476 Hz
         66646,  // 250:  762699 Hz
         70356,  // 251:  805160 Hz
         74273,  // 252:  849986 Hz
         78408,  // 253:  897307 Hz
         82773,  // 254:  947263 Hz
         87381,  // 255: 1000000 Hz
};

/*
 * ARCHIVED: 1 Hz to 3 MHz table (commented out for reference)
 * 
 * To restore: uncomment this table and comment out the one above.
 * Step ratio was 6.06% per index. Crossover at index 42 (~12 Hz).
 * Max NCO increment 262144 for 3 MHz.
 *
static const uint32_t freq_table_3mhz[256] = {
    // Index 0-41: Software mode (1 Hz to 11 Hz)
    0x80B71B00,  //   0:    1.00 Hz
    0x80ACB411,  //   1:    1.06 Hz
    0x80A2E469,  //   2:    1.12 Hz
    0x8099A371,  //   3:    1.19 Hz
    0x8090E90D,  //   4:    1.26 Hz
    0x8088AD98,  //   5:    1.34 Hz
    0x8080E9DC,  //   6:    1.42 Hz
    0x8079970D,  //   7:    1.51 Hz
    0x8072AEBF,  //   8:    1.60 Hz
    0x806C2AE5,  //   9:    1.69 Hz
    0x806605CC,  //  10:    1.79 Hz
    0x80603A10,  //  11:    1.90 Hz
    0x805AC29F,  //  12:    2.02 Hz
    0x80559AAE,  //  13:    2.14 Hz
    0x8050BDB9,  //  14:    2.27 Hz
    0x804C277D,  //  15:    2.40 Hz
    0x8047D3F7,  //  16:    2.55 Hz
    0x8043BF5C,  //  17:    2.70 Hz
    0x803FE618,  //  18:    2.87 Hz
    0x803C44CE,  //  19:    3.04 Hz
    0x8038D84E,  //  20:    3.22 Hz
    0x80359D99,  //  21:    3.42 Hz
    0x803291DB,  //  22:    3.62 Hz
    0x802FB26A,  //  23:    3.84 Hz
    0x802CFCC0,  //  24:    4.07 Hz
    0x802A6E7D,  //  25:    4.32 Hz
    0x80280566,  //  26:    4.58 Hz
    0x8025BF5E,  //  27:    4.85 Hz
    0x80239A66,  //  28:    5.14 Hz
    0x8021949E,  //  29:    5.45 Hz
    0x801FAC3F,  //  30:    5.78 Hz
    0x801DDFA0,  //  31:    6.13 Hz
    0x801C2D2B,  //  32:    6.50 Hz
    0x801A9365,  //  33:    6.89 Hz
    0x801910E6,  //  34:    7.30 Hz
    0x8017A45C,  //  35:    7.74 Hz
    0x80164C87,  //  36:    8.21 Hz
    0x8015083B,  //  37:    8.71 Hz
    0x8013D65B,  //  38:    9.23 Hz
    0x8012B5DC,  //  39:    9.79 Hz
    0x8011A5C0,  //  40:   10.38 Hz
    0x8010A51A,  //  41:   11.00 Hz
    // Index 42-255: NCO mode (12 Hz to 3 MHz)
             1,  //  42:      12 Hz
             ...
        262144,  // 255: 3000000 Hz
};
*/

#endif // FREQ_TABLE_H
